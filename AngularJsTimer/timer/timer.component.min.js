(function(){"use strict";function n(n){function o(){console.debug("startStop");t.isRunning?(console.debug("Stopping..."),e()):(console.debug("Starting..."),a())}function s(){console.debug("PauseResume");t.isRunning?b():v()}function h(){l();c()}function c(){t.setting={};t.setting.prepare=10;t.setting.work=20;t.setting.rest=10;t.setting.cycles=8;t.setting.intervals=1;t.setting.timer={hours:0,minutes:0,seconds:0}}function l(){console.debug("resetCounter");t.runningConfig.timer={hours:0,minutes:0,seconds:0};t.runningConfig.overalltimer={hours:0,minutes:0,seconds:0};t.runningConfig.cycles=0;t.runningConfig.intervals=0}function a(){console.debug("Start");y();t.runningConfig.intervals>0&&(p(),--t.runningConfig.intervals,u(),t.state="Prepare",t.timeoutPromise=n(i,1e3),t.isRunning=!0,t.StartStop="Stop",t.disablePauseResume=!1,t.PauseResume="Pause")}function v(){console.debug("Resume");t.isRunning=!0;t.StartStop="Stop";t.disablePauseResume=!1;t.PauseResume="Pause";t.timeoutPromise=n(i,1e3)}function y(){t.runningConfig=JSON.parse(JSON.stringify(t.setting))}function p(){var u=t.runningConfig.intervals*(t.runningConfig.prepare+t.runningConfig.cycles*(t.runningConfig.rest+t.runningConfig.work)),n=parseInt(u,10),i=Math.floor(n/3600),r=Math.floor((n-i*3600)/60),f=n-i*3600-r*60;t.runningConfig.overalltimer={hours:i,minutes:r,seconds:f}}function u(){t.runningConfig.timer={hours:0,minutes:0,seconds:t.runningConfig.prepare}}function f(){t.runningConfig.timer={hours:0,minutes:0,seconds:t.runningConfig.work}}function w(){t.runningConfig.timer={hours:0,minutes:0,seconds:t.runningConfig.rest}}function b(){console.debug("Pause");n.cancel(t.timeoutPromise);t.isRunning=!1;t.StartStop="Start";t.PauseResume="Resume"}function e(){console.debug("Stop");t.isRunning&&(n.cancel(t.timeoutPromise),t.isRunning=!1);t.StartStop="Start";t.disablePauseResume=!0;t.PauseResume="Pause"}function i(){console.debug("decrementCounter");t.runningConfig.timer.seconds>0?t.runningConfig.timer.seconds--:t.runningConfig.timer.minutes>0?(t.runningConfig.timer.minutes--,t.runningConfig.timer.seconds=r(t.runningConfig.timer.seconds)):t.runningConfig.timer.hours>0&&(t.runningConfig.timer.hours--,t.runningConfig.timer.minutes=r(t.runningConfig.timer.minutes),t.runningConfig.timer.seconds=r(t.runningConfig.timer.seconds));t.runningConfig.overalltimer.seconds>0?t.runningConfig.overalltimer.seconds--:t.runningConfig.overalltimer.minutes>0?(t.runningConfig.overalltimer.minutes--,t.runningConfig.overalltimer.seconds=r(t.runningConfig.overalltimer.seconds)):t.runningConfig.overalltimer.hours>0&&(t.runningConfig.overalltimer.hours--,t.runningConfig.overalltimer.minutes=r(t.runningConfig.overalltimer.minutes),t.runningConfig.overalltimer.seconds=r(t.runningConfig.overalltimer.seconds));k(t.runningConfig.timer.hours,t.runningConfig.timer.minutes,t.runningConfig.timer.seconds)?t.timeoutPromise=n(i,1e3):t.state==="Prepare"?(t.runningConfig.cycles>0&&--t.runningConfig.cycles,f(),t.state="Work",t.timeoutPromise=n(i,1e3)):t.state==="Work"?(w(),t.state="Rest",t.timeoutPromise=n(i,1e3)):t.state==="Rest"&&(t.runningConfig.cycles!==0?(--t.runningConfig.cycles,f(),t.state="Work",t.timeoutPromise=n(i,1e3)):t.runningConfig.intervals!==0?(t.runningConfig.cycles=t.setting.cycles,--t.runningConfig.intervals,u(),t.state="Prepare",t.timeoutPromise=n(i,1e3)):(t.state="Idle",e()))}function r(n){var t=n;return n>0?--n:59}function k(n,t,i){return!(n===0&&t===0&&i===0)}var t=this;t.disablePauseResume=!0;t.isRunning=!1;t.state="Idle";t.StartStop="Start";t.PauseResume="Pause";t.timeoutPromise=null;t.runningConfig={};h();t.startStop=o;t.pauseResume=s}angular.module("timer").component("timer",{templateUrl:"timer/timer.view.html",controller:"TimerController as vm"}).controller("TimerController",n);n.$inject=["$timeout","$rootScope"]})();